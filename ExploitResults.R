library("limma")
Input<-read.table("ResultsDAProt.txt",header=TRUE)
rownames(Input)<-Input$ProteinID


HighlightAState<-function(Input,State="State4",refState="State1",threshold=Threshold){
	Highlight.Names<-colnames(Input)[intersect(
		grep(paste(State,refState,sep="."),colnames(Input)),
		intersect(grep("Log2FC_|pVal_",colnames(Input)),
		grep(paste("*",refState,"*",refState,sep="."),colnames(Input))))]
	LFCs<-Highlight.Names[grep("Log2FC_",Highlight.Names)]
	LFCsToInvert<-LFCs[grep(paste(State,".",refState,"$",sep=""),LFCs)]
	PvalsNames<-Highlight.Names[grep("pVal_",Highlight.Names)]
	LocalStatus<-c()
	for(LocalComparison in PvalsNames){
		#LocalComparison<-PvalsNames[3]
		LocalStatusName<-gsub("pVal_","Status_",LocalComparison)
		LocalFC<-gsub("pVal_","Log2FC_",LocalComparison)
		Input[,LocalStatusName]<-0
		Input[Input[,LocalComparison]<Threshold & !is.na(Input[,LocalComparison]),LocalStatusName]<-1
		if(LocalFC %in% LFCsToInvert){
			Input[,LocalStatusName]<-Input[,LocalStatusName]* -sign(Input[,LocalFC])
			NewLocalStatusName<-LocalStatusName
			NewLocalStatusName<-gsub(
				paste(".",State,".",refState,sep=""),
				"",
				NewLocalStatusName)
			NewLocalStatusName<-gsub("Status_",
				paste("Status_",State,".",refState,".",sep=""),
				NewLocalStatusName)
			colnames(Input)<-gsub(LocalStatusName,NewLocalStatusName,colnames(Input))
			LocalStatus<-c(LocalStatus,NewLocalStatusName)
		}else{
			Input[,LocalStatusName]<-Input[,LocalStatusName]*sign(Input[,LocalFC])
			LocalStatus<-c(LocalStatus,LocalStatusName)
		}
	}
	LocalMatrix<-Input[,LocalStatus]
	LocalMatrix<-LocalMatrix[rowSums(is.na(LocalMatrix))==0,]
	LocalCounts<-vennCounts(LocalMatrix,include="up")
	vennDiagram(LocalCounts)
}

StateOfRef<-"State1"
StateOfInterest<-c("State2","State3","State4","State5")
EnrichOverHeavy.colnames<-c("ProteinID")
Threshold<-0.01
FCs<-c()
Pvals<-c()
Status<-c()
for(LocalStateOfInterest in StateOfInterest){
	#LocalStateOfInterest<-StateOfInterest[1]
	LocalLog2FC<-paste("Log2FC_",LocalStateOfInterest,".",StateOfRef,sep="")
	LocalPval<-paste("pVal_",LocalStateOfInterest,".",StateOfRef,sep="")
	LocalStatus<-paste("Status_",LocalStateOfInterest,".",StateOfRef,sep="")
	Status<-c(Status,LocalStatus)
	Input[,LocalStatus]<-0
	Input[Input[,LocalPval]<Threshold & !is.na(Input[,LocalPval]),LocalStatus]<-1
	Input[,LocalStatus]<-sign(Input[,LocalLog2FC])*Input[,LocalStatus]
	FCs<-c(FCs,LocalLog2FC)
	Pvals<-c(Pvals,LocalPval)
	EnrichOverHeavy.colnames<-c(EnrichOverHeavy.colnames,LocalLog2FC,LocalPval,LocalStatus)
}

Input.EnrichOverHeavy<-Input[,EnrichOverHeavy.colnames]
###!!!!
Input.EnrichOverHeavy.Matrix<-Input.EnrichOverHeavy[,Status]
Input.EnrichOverHeavy.Matrix<-Input.EnrichOverHeavy.Matrix[rowSums(is.na(Input.EnrichOverHeavy.Matrix))==0,]
Input.EnrichOverHeavy.Counts<-vennCounts(Input.EnrichOverHeavy.Matrix,include="up")


